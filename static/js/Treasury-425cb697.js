import{Q as c,Z as os,O as H,_ as z,d as Q,r as A,o as cs,a as rs,b as _,c as b,M as O,a2 as E,e as a,t as l,w as ls,v as us,h as p,i as m,k as is,l as w,j as L,n as F,g as j,p as ds,q as vs,a3 as _s,a4 as ps,a5 as hs}from"./index-16381e0d.js";import{g as fs,u as ys,t as P,b as gs,a as V,H as ms}from"./useLendingPool-dd72a023.js";const W=()=>{const d=async()=>{const{treasuryAddress:n}=ys();return await n()},u=fs(d());return{getContractAddress:d,usdtAddress:async()=>{try{return await u.USDT()}catch(n){return n}},bondsAddress:async()=>{try{return await u.BONDS()}catch(n){return n}},poolLength:async()=>{try{const n=await u.poolLength();return c.successResult(n)}catch(n){return c.failResult(n)}},poolInfo:async n=>{try{const t=await u.poolInfo(n);return c.successResult(t)}catch(t){return c.failResult(t)}},mint:async(n,t)=>{try{const T=await(await u.mint(n,os(t))).wait();return c.successResult(T)}catch(T){return P(T),c.failResult(T)}},bondsInfo:async n=>{try{const t=await u.bondsInfo(n);return c.successResult(t)}catch(t){return c.failResult(t)}},pending:async n=>{try{const t=await u.pending(n);return c.successResult(t)}catch(t){return c.failResult(t)}},redeem:async n=>{try{const t=await u.redeem(n);return c.successResult(t)}catch(t){return P(t),c.failResult(t)}},harvest:async n=>{try{const t=await u.harvest(n);return c.successResult(t)}catch(t){return P(t),c.failResult(t)}}}},bs=()=>{const u=gs((async()=>{const{bondsAddress:h}=W();return await h()})());return{balanceOf:async h=>{const{accountStore:k}=H(),I=h||k.account;try{const f=await u.balanceOf(I);return c.successResult(f)}catch(f){return c.failResult(f)}},getTokenIds:async(h,k=0,I)=>{const{accountStore:f}=H(),B=I||f.account;try{const $=await u.getTokenIds(B,k,h);return c.successResult($)}catch($){return c.failResult($)}}}};const X=d=>(ds("data-v-3f49bac4"),d=d(),vs(),d),ws={class:"subtitle-line"},ks={class:"subtitle"},Cs={class:"explain-line"},Is=X(()=>a("div",{class:"explain-item border-right"},[L(` <div class="text-green">0.01MUSD/1USDT{{$t('musd.treasuryBill')}}</div> `),L(` <div class="text-gray">{{$t('musd.yesterdayDividend')}}</div> `)],-1)),$s={class:"explain-item"},Ts={class:"text-white"},As={class:"text-gray"},Ls={class:"input-box"},Bs=["placeholder","onUpdate:modelValue"],Rs={class:"input-btn"},Ss=w("25%"),Us=w("50%"),Ds=w("75%"),Ms=w("MAX"),Os={class:"btn-group"},Ps={key:0,class:"serial-no"},Vs=X(()=>a("div",{class:"line"},null,-1)),Ns={key:0,class:"box"},qs={class:"subtitle-line"},Hs={class:"subtitle"},Es={class:"info-line"},Fs={class:"info-left"},js={class:"serial-number"},zs={class:"info-time"},Qs={class:"info-status status-orange"},Ws={class:"cell"},Xs={class:"cell-left"},Zs={class:"cell-right"},xs={class:"cell"},Gs={class:"cell-left"},Js={class:"cell-right"},Ks={class:"btn-group"},Ys=Q({setup(d){const{getContractAddress:u,usdtAddress:C,poolLength:U,poolInfo:h,mint:k,bondsInfo:I,redeem:f,harvest:B,pending:$}=W(),{balanceOf:N,getTokenIds:n}=bs(),t=A([]),T=async()=>{const s=await U();if(!(!s.success||!s.result)){t.value=[];for(let e=0;e<s.result;e++)Z(e)}},Z=async s=>{const e=await h(s);!e.success||(t.value.push({pid:s,duration:_s(e.result.duration),allocPoint:e.result.allocPoint/1e3,buyLoading:!1,buyAmount:null}),console.log(t.value))},y=A(!1),D=A(!1),R=A(0),M=A(!0),x=async()=>{const{isApprove:s}=V(await C());y.value=await s(await u()),console.log("authUsdt",y.value),y.value&&(M.value=!1)},G=async()=>{const{approve:s}=V(await C());D.value=!0;const e=await s(await u());D.value=!1,e.success&&(y.value=!0)},J=async()=>{const{balanceOf:s}=V(await C()),e=await s();!e.success||(R.value=j(e.result),console.log(R.value))},S=(s,e)=>{t.value[e].buyAmount=j(s*R.value)},K=async(s,e)=>{t.value[e].buyLoading=!0;const o=await k(s,t.value[e].buyAmount);t.value[e].buyLoading=!1,o.success&&q()},Y=async()=>{const s=await N();!s.success||ss(s.result)},v=A([]),ss=async s=>{const e=await n(s);!e.success||(v.value=[],e.result.forEach(o=>{es(o)}))},es=async s=>{const e=await I(s);if(!e.success)return;const o={tokenId:s,...e.result,amount:ps(e.result.amount),dueTime:e.result.dueTime,expireTime:hs(e.result.dueTime),pid:+e.result.pid||void 0,redeemLoading:!1,harvestLoading:!1};ts(s,o)},ts=async(s,e)=>{const o=await $([s]);e.rewards=o.result[0],v.value.push(e),console.log("bondsInfoList",v)},as=async(s,e)=>{v.value[e].redeemLoading=!0;const o=await f(s);v.value[e].redeemLoading=!1,o.success},ns=async(s,e)=>{v.value[e].harvestLoading=!0;const o=await B([s]);v.value[e].harvestLoading=!1,o.success},q=()=>{T(),x(),J(),Y()};return cs(async()=>{q()}),(s,e)=>{const o=rs("VanButton");return _(),b(O,null,[(_(!0),b(O,null,E(t.value,(r,i)=>(_(),b("div",{class:"box",key:i},[a("div",ws,[a("div",ks,l(s.$t("musd.treasuryBillCycle",{day:r.duration||"-"})),1)]),a("div",Cs,[Is,a("div",$s,[a("div",Ts,l(s.$t("musd.basicPoint",{num:r.allocPoint||"-"})),1),a("div",As,l(s.$t("musd.dividendBasis")),1)])]),a("div",Ls,[ls(a("input",{placeholder:s.$t("musd.availableBalance",{balance:R.value}),class:"input","onUpdate:modelValue":g=>r.buyAmount=g},null,8,Bs),[[us,r.buyAmount]]),a("div",Rs,[p(o,{class:"btn",onClick:g=>S(.25,i)},{default:m(()=>[Ss]),_:2},1032,["onClick"]),p(o,{class:"btn",onClick:g=>S(.5,i)},{default:m(()=>[Us]),_:2},1032,["onClick"]),p(o,{class:"btn",onClick:g=>S(.75,i)},{default:m(()=>[Ds]),_:2},1032,["onClick"]),p(o,{class:"btn",onClick:g=>S(1,i)},{default:m(()=>[Ms]),_:2},1032,["onClick"])])]),a("div",Os,[M.value?(_(),is(o,{key:0,class:"btn-item margin",disabled:y.value,loading:D.value,onClick:G},{default:m(()=>[w(l(s.$t("musd.approve",{tokenName:"USDT"})),1)]),_:1},8,["disabled","loading"])):L("v-if",!0),p(o,{class:"btn-item btn-right",disabled:!y.value||!r.buyAmount,loading:r.buyLoading,onClick:g=>K(r.pid,i)},{default:m(()=>[w(l(s.$t("musd.buy")),1)]),_:2},1032,["disabled","loading","onClick"])]),M.value?(_(),b("div",Ps,[a("div",{class:F(["no",{active:!y.value}])},"1",2),Vs,a("div",{class:F(["no",{active:y.value}])},"2",2)])):L("v-if",!0)]))),128)),v.value.length?(_(),b("div",Ns,[a("div",qs,[a("div",Hs,l(s.$t("musd.loanHistory")),1)]),(_(!0),b(O,null,E(v.value,(r,i)=>(_(),b("div",{class:"block",key:i},[a("div",Es,[a("div",Fs,[a("div",js,l(s.$t("musd.treasuryBill")),1),a("div",zs,l(s.$t("musd.expireTime"))+" "+l(r.expireTime),1)]),a("div",Qs,l(s.$t("musd.number"))+" "+l(r.tokenId),1)]),a("div",Ws,[a("div",Xs,l(s.$t("musd.denomination")),1),a("div",Zs,l(r.amount||0)+" MUSD",1)]),a("div",xs,[a("div",Gs,l(s.$t("musd.incomeReceived")),1),a("div",Js,l(r.rewards||0)+" MUSD",1)]),a("div",Ks,[p(o,{class:"btn-item margin btn-border",loading:r.redeemLoading,onClick:g=>as(r.tokenId,i)},{default:m(()=>[w(l(s.$t("musd.redeem")),1)]),_:2},1032,["loading","onClick"]),p(o,{class:"btn-item",disabled:r.rewards==0,loading:r.harvestLoading,onClick:g=>ns(r.tokenId,i)},{default:m(()=>[w(l(s.$t("musd.receiveIncome")),1)]),_:2},1032,["disabled","loading","onClick"])])]))),128))])):L("v-if",!0)],64)}}}),se=z(Ys,[["__scopeId","data-v-3f49bac4"],["__file","/Users/wangkeai/work/xueyan/mai/FullReturn/src/view/treasury/components/TreasuryBillModule.vue"]]);const ee={class:"wrapper"},te={class:"content"},ae=Q({setup(d){return(u,C)=>(_(),b("div",ee,[p(ms,{activeIndex:2}),a("div",te,[p(se)])]))}}),ce=z(ae,[["__scopeId","data-v-3bc6385e"],["__file","/Users/wangkeai/work/xueyan/mai/FullReturn/src/view/treasury/Treasury.vue"]]);export{ce as default};

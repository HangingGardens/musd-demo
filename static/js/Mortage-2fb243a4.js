import{_ as Z,d as x,u as Ms,a0 as $s,r as n,a1 as J,g as b,o as Cs,a as Ls,b as i,c,e,t as a,j as u,M as K,a2 as X,k as w,i as r,l as _,f as v,a3 as z,n as I,w as Rs,v as Ss,h as A,m as F,a4 as q,a5 as W,p as Fs,q as Bs}from"./index-2a12fd2b.js";import{u as Ds,a as B,H as Ps}from"./useLendingPool-5941b17e.js";const Us="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAASJJREFUOE+lk00rRWEUhZ+FRJEUZWLg20ApRSZGfreRiSilKHGviYmiJErJtbRv+5zec69LOHUG78d+9tpr71f889NX8baHgVlgIs9fgHtJnd77fQDbS0D8j8BzBkwC00BbUruENAC2t4BR4EzSa3nR9jiwCbxJOq3OakBmDtnHkj5sLwIrgIGWpBvbQ8BOltNV0gVkzfvAYWS2PQNsAEd5J4IuJD2kkj3gIDypAHPAvKSTBC5EYGTN9RrQkdTK9TZwK+muAiwDI5Iue122PQbsAuehIAHrwHsAvwUUPlxXagYBGiVUKmyvdo2Srno60ldCDE5tYgGYSsBTsRftbJqYsmJ46jbmXgMwsI0FvTFItmvAj4NUQP4+ygXk74/pt6/7E3oxqRHPc+nPAAAAAElFTkSuQmCC";const Q=y=>(Fs("data-v-7c2a74df"),y=y(),Bs(),y),Es={class:"box"},Ts={class:"subtitle-line"},Ns={class:"subtitle"},Hs={class:"tag-group"},Vs={key:0,class:"tip-box"},Js=Q(()=>e("div",{class:"tip-icon"},[e("img",{src:Us})],-1)),Qs={class:"subtitle-line subtitle-margin-top"},Gs={class:"subtitle"},Ys={class:"subtitle-right"},js={class:"input-box"},Os=["placeholder"],Ks={class:"input-btn"},Xs=_("25%"),zs=_("50%"),qs=_("75%"),Ws=_("MAX"),Zs={class:"subtitle-line subtitle-margin-top"},xs={class:"subtitle"},se={class:"cell"},ee={class:"cell-left"},te={class:"cell-right"},ae={class:"cell"},oe={class:"cell-left"},le={class:"cell-right"},ne={class:"cell"},ie={class:"cell-left"},ue={class:"cell-right"},ce={class:"btn-group"},de={key:1,class:"serial-no"},re=Q(()=>e("div",{class:"line"},null,-1)),ve={key:2,class:"box"},_e={class:"subtitle-line"},pe={class:"subtitle"},ge={class:"info-line"},me={class:"info-left"},fe={class:"serial-number"},he={class:"info-time"},Ae={key:0,class:"info-status status-green"},be={key:1,class:"info-status status-red"},ye={class:"cell"},ke={class:"cell-left"},we={class:"cell-right"},Ie={class:"cell"},Me={class:"cell-left"},$e={class:"cell-right"},Ce={class:"cell"},Le={class:"cell-left"},Re={class:"cell-right"},Se={class:"btn-group"},Fe={key:0,class:"serial-no"},Be=Q(()=>e("div",{class:"line"},null,-1)),De=x({setup(y){Ms();const{musdAddress:D,poolLength:G,poolInfo:ss,borrow:es,getLoanIds:ts,loans:as,repay:os,getPrice:ls,maiAddress:Y,rollover:ns}=Ds(),{isApprove:is,approve:us}=B(Y()),cs=$s({7:0,90:15,180:30,365:65}),g=n([]),ds=async()=>{const s=await G();if(!s.success||!s.result)return;g.value=[];let t=[];for(let l=0;l<s.result;l++){const o=await rs(l);t.push(o)}g.value=t.sort((l,o)=>l.pid-o.pid),g.value.splice(0,1),M.value=g.value[0].pid},rs=async s=>{const t=await ss(s);if(!!t.success)return{pid:s,duration:t.result.duration,interestRate:t.result.interestRate/1e3,penaltyRate:t.result.penaltyRate/1e3}},M=n(0),j=n(0),f=J(()=>g.value[j.value]);J(()=>f.value?b(d.value*(f.value.interestRate||0)/100):0);const vs=J(()=>b(d.value)),_s=(s,t)=>{M.value=s.pid,j.value=t},p=n(!1),P=n(!1),$=n(0),U=n(!0),ps=async()=>{p.value=await is(F.lendingPool),p.value&&(U.value=!1)},gs=async()=>{P.value=!0;const s=await us(F.lendingPool);P.value=!1,s.success&&(p.value=!0)},k=n(!1),E=n(!1),T=n(!0),ms=async()=>{const{isApprove:s}=B(D());k.value=await s(F.lendingPool),k.value&&(T.value=!1)},fs=async()=>{const{approve:s}=B(D());E.value=!0;const t=await s(F.lendingPool);E.value=!1,t.success&&(k.value=!0)},d=n(0),C=n(0),hs=async()=>{const s=await ls();!s.success||(C.value=s.result,console.log(C.value,"exchangeRatio"))},L=n(0),O=async()=>{const{balanceOf:s}=B(Y()),t=await s();!t.success||($.value=b(t.result),L.value=b($.value*C.value),console.log($.value,L.value))},N=n(!1),As=async()=>{N.value=!0;const s=await es(M.value,d.value);N.value=!1,s.success&&(d.value=0,O(),S())},R=s=>{d.value=b(s*L.value)},h=n([]),H=n([]),S=async()=>{const s=await ts();H.value=[],!(!s.success||!s.result.length)&&((s.result||[]).forEach(async t=>{const l=await bs(t);H.value.push(l)}),h.value=H.value)},bs=async s=>{const t=await as(s);if(!t.success)return;const l=g.value.findIndex(Is=>Is.pid===+t.result.pid),o=+(t.result.dueTime||0),m=o-g.value[l].duration;return{loanId:s,...t.result,loanAmount:q(t.result.loanAmount),collateralAmount:q(t.result.collateralAmount),startTime:W(m),endTime:W(o),loanStatus:new Date().getTime()<o*1e3?1:2,loanLoading:!1,rolloverLoading:!1}};n(!1);const ys=async(s,t)=>{h.value[t].loanLoading=!0;const l=await os(s);h.value[t].loanLoading=!1,l.success&&S()},ks=async(s,t)=>{h.value[t].rolloverLoading=!0;const l=await ns(s);h.value[t].rolloverLoading=!1,l.success&&S()},ws=async()=>{ps(),ms(),await ds(),await hs(),O(),S()};return Cs(async()=>{ws()}),(s,t)=>{const l=Ls("VanButton");return i(),c("div",Es,[e("div",Ts,[e("div",Ns,a(s.$t("musd.lendingDuration")),1)]),u(" \u6C60\u5B50\u5FAA\u73AF "),e("div",Hs,[(i(!0),c(K,null,X(g.value,(o,m)=>(i(),w(l,{key:m,onClick:V=>_s(o,m),class:I(["tag-item",{"tag-border":o.pid===M.value}])},{default:r(()=>[_(a(v(z)(o.duration)+s.$t("musd.days")),1)]),_:2},1032,["onClick","class"]))),128))]),u(" \u9009\u4E2D\u6C60\u5B50\u4FE1\u606F "),v(f)?(i(),c("div",Vs,[e("div",null,a(s.$t("musd.borrowingCosts"))+"\uFF1A"+a(v(f).interestRate||"-")+"%",1),e("div",null,a(s.$t("musd.penaltyRatio"))+"\uFF1A"+a(v(f).penaltyRate||"-")+"%",1),e("div",null,a(s.$t("musd.Additional",{day:v(cs)[v(z)(v(f).duration)]||0}))+"\uFF1A"+a(v(f).interestRate||"-")+"%",1),e("div",null,a(s.$t("musd.borrowingfeesreturn")),1),Js])):u("v-if",!0),e("div",Qs,[e("div",Gs,a(s.$t("musd.loanAmount"))+"(MUSD)",1),e("div",Ys,a(s.$t("musd.mortgagableAssets"))+"\uFF1A"+a($.value)+" MAI",1)]),u(" \u501F\u8D37\u8F93\u5165 "),e("div",js,[Rs(e("input",{placeholder:s.$t("musd.maximumLoanable",{maxLoanMusd:L.value||0}),class:"input","onUpdate:modelValue":t[0]||(t[0]=o=>d.value=o)},null,8,Os),[[Ss,d.value]]),e("div",Ks,[A(l,{class:"btn",onClick:t[1]||(t[1]=o=>R(.25))},{default:r(()=>[Xs]),_:1}),A(l,{class:"btn",onClick:t[2]||(t[2]=o=>R(.5))},{default:r(()=>[zs]),_:1}),A(l,{class:"btn",onClick:t[3]||(t[3]=o=>R(.75))},{default:r(()=>[qs]),_:1}),A(l,{class:"btn",onClick:t[4]||(t[4]=o=>R(1))},{default:r(()=>[Ws]),_:1})])]),u(" \u501F\u8D37\u9884\u89C8 "),e("div",null,[e("div",Zs,[e("div",xs,a(s.$t("musd.creditPreview")),1)]),e("div",se,[e("div",ee,a(s.$t("musd.collateralAssets")),1),e("div",te,a(v(b)(d.value/C.value||0))+" MAI",1)]),e("div",ae,[e("div",oe,a(s.$t("musd.loanAmount")),1),e("div",le,a(d.value||0)+" MUSD",1)]),u(` <div class="cell">
        <div class="cell-left">{{$t('musd.deductionCosts', {num: selectPooInfo ? selectPooInfo.interestRate : '-'})}}
        </div>
        <div class="cell-right">{{loanCost || 0}} MUSD</div>
      </div> `),e("div",ne,[e("div",ie,a(s.$t("musd.actualArrival")),1),e("div",ue,a(v(vs)||0)+" MUSD",1)])]),u(" \u501F\u8D37\u7533\u8BF7 "),e("div",ce,[U.value?(i(),w(l,{key:0,class:"btn-item margin",disabled:p.value,loading:P.value,onClick:gs},{default:r(()=>[_(a(s.$t("musd.approve",{tokenName:"MAI"})),1)]),_:1},8,["disabled","loading"])):u("v-if",!0),A(l,{class:"btn-item btn-right",disabled:!p.value||!d.value,loading:N.value,onClick:As},{default:r(()=>[_(a(s.$t("musd.submitApplication")),1)]),_:1},8,["disabled","loading"])]),U.value?(i(),c("div",de,[e("div",{class:I(["no",{active:!p.value}])},"1",2),re,e("div",{class:I(["no",{active:p.value}])},"2",2)])):u("v-if",!0),h.value.length?(i(),c("div",ve,[e("div",_e,[e("div",pe,a(s.$t("musd.loanHistory")),1)]),(i(!0),c(K,null,X(h.value,(o,m)=>(i(),c("div",{class:"block",key:m},[e("div",ge,[e("div",me,[e("div",fe,a(s.$t("musd.serialNumber"))+"\uFF1A"+a(o.loanId),1),e("div",he,a(o.startTime),1)]),o.loanStatus===1?(i(),c("div",Ae,a(s.$t("musd.ongoing")),1)):o.loanStatus===2?(i(),c("div",be,a(s.$t("musd.overdue")),1)):u("v-if",!0)]),e("div",ye,[e("div",ke,a(s.$t("musd.loanAmount")),1),e("div",we,a(o.loanAmount)+" MUSD",1)]),e("div",Ie,[e("div",Me,a(s.$t("musd.initialPledgedAssets")),1),e("div",$e,a(o.collateralAmount)+" MAI",1)]),e("div",Ce,[e("div",Le,a(s.$t("musd.expireDay")),1),e("div",Re,a(o.endTime),1)]),e("div",Se,[!k.value&&T.value?(i(),w(l,{key:0,class:"btn-item margin",onClick:fs,loading:E.value},{default:r(()=>[_(a(s.$t("musd.approve",{tokenName:"MUSD"})),1)]),_:1},8,["loading"])):(i(),w(l,{key:1,class:"btn-item margin",loading:o.rolloverLoading,onClick:V=>ks(o.loanId,m)},{default:r(()=>[_(a(s.$t("musd.relloverLoan")),1)]),_:2},1032,["loading","onClick"])),o.status?u("v-if",!0):(i(),w(l,{key:2,class:"btn-item btn-right",disabled:!k.value,onClick:V=>ys(o.loanId,m),loading:o.loanLoading},{default:r(()=>[_(a(s.$t("musd.repayLoan")),1)]),_:2},1032,["disabled","onClick","loading"]))]),T.value?(i(),c("div",Fe,[e("div",{class:I(["no",{active:!p.value}])},"1",2),Be,e("div",{class:I(["no",{active:p.value}])},"2",2)])):u("v-if",!0)]))),128))])):u("v-if",!0)])}}}),Pe=Z(De,[["__scopeId","data-v-7c2a74df"],["__file","/Users/wangkeai/work/xueyan/mai/FullReturn/src/view/mortage/components/MortgageLendingModule.vue"]]);const Ue={class:"wrapper"},Ee={class:"content"},Te=x({setup(y){return n(0),(D,G)=>(i(),c("div",Ue,[A(Ps,{activeIndex:1}),e("div",Ee,[A(Pe)])]))}}),Ve=Z(Te,[["__scopeId","data-v-220b0576"],["__file","/Users/wangkeai/work/xueyan/mai/FullReturn/src/view/mortage/Mortage.vue"]]);export{Ve as default};
